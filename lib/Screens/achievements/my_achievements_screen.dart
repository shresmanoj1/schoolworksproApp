import 'package:cached_network_image/cached_network_image.dart';import 'package:flutter/cupertino.dart';import 'package:flutter/material.dart';import 'package:flutter_spinkit/flutter_spinkit.dart';import 'package:provider/provider.dart';import 'package:schoolworkspro_app/Screens/achievements/achievement_view_model.dart';import 'package:intl/intl.dart';import 'package:schoolworkspro_app/Screens/achievements/view_certificate_web_view.dart';import 'package:schoolworkspro_app/constants/colors.dart';import 'package:share_plus/share_plus.dart';import 'package:url_launcher/url_launcher.dart';import '../../api/api.dart';import '../../config/api_response_config.dart';import '../../constants.dart';class MyAchievementScreen extends StatefulWidget {  const MyAchievementScreen({Key? key}) : super(key: key);  @override  State<MyAchievementScreen> createState() => _MyAchievementScreenState();}class _MyAchievementScreenState extends State<MyAchievementScreen> {  late AchievementViewModel _provider;  @override  void initState() {    WidgetsBinding.instance.addPostFrameCallback((timeStamp) {      _provider = Provider.of<AchievementViewModel>(context, listen: false);      // _provider.fetchMyAchievements();    });    super.initState();  }  @override  Widget build(BuildContext context) {    return Scaffold(      appBar: AppBar(          centerTitle: false,          title: const Text("My Achievement", style: TextStyle(color: white)),          elevation: 0.0,          iconTheme: const IconThemeData(            color: white, //change your color here          ),          backgroundColor: logoTheme),      body: Consumer<AchievementViewModel>(        builder: (context, snapShot, child) {          return isLoading(snapShot.myAchievementApiResponse)              ? const Center(                  child: SpinKitDualRing(                  color: kPrimaryColor,                ))              : snapShot.myAchievement.achievements == null ||                      snapShot.myAchievement.achievements!.isEmpty                  ? Image.asset("assets/images/no_content.PNG")                  : Column(                      children: [                        Expanded(                            child: GridView.builder(                                padding: EdgeInsets.symmetric(                                    horizontal: 10, vertical: 10),                                itemCount:                                    snapShot.myAchievement.achievements!.length,                                gridDelegate:                                    const SliverGridDelegateWithFixedCrossAxisCount(                                  crossAxisCount: 2,                                  crossAxisSpacing: 4.0,                                  mainAxisSpacing: 4.0,                                  childAspectRatio: 0.778,                                ),                                itemBuilder: (BuildContext context, int index) {                                  var value2 = snapShot                                      .myAchievement.achievements![index];                                  return Container(                                    // padding: EdgeInsets.symmetric(horizontal: 5, vertical: 10),                                    decoration: BoxDecoration(                                        // color: Colors.white,                                        // borderRadius: BorderRadius.circular(10),                                        border: Border.all(color: Colors.grey)),                                    child: Column(                                      crossAxisAlignment:                                          CrossAxisAlignment.center,                                      children: [                                        Center(                                            child: Image.asset(                                                "assets/icons/achievements_logo.png", height: 77,)),                                        const SizedBox(                                          height: 10,                                        ),                                        Center(                                            child: Text(                                          "Certificate of Completion",                                          style: TextStyle(                                              color: solidRed,                                              fontSize: 13,                                              fontWeight: FontWeight.bold),                                          textAlign: TextAlign.center,                                        )),                                        const SizedBox(                                          height: 10,                                        ),                                        Text(                                          value2.moduleId!.moduleTitle                                              .toString(),                                          style: TextStyle(                                              fontSize: 13,                                              color: Color(0xff004D96),                                              fontWeight: FontWeight.w600),                                          maxLines: 2,                                          overflow: TextOverflow.ellipsis,                                          textAlign: TextAlign.center,                                        ),                                        const SizedBox(                                          height: 10,                                        ),                                        Text(                                          "Achieved at: ${DateFormat('MMM dd, yyyy').format(value2.achievedAt!)}",                                          style: const TextStyle(                                              fontSize: 12, color: Colors.grey),                                        ),                                        // const SizedBox(                                        //   height: 10,                                        // ),                                        Spacer(),                                        Row(                                          children: [                                            Expanded(                                                child: InkWell(                                              onTap: () async {                                                String url1 =                                                    "https://schoolworkspro.com/certificate/${value2.id}";                                                var url = Uri.parse(url1);                                                if (await canLaunchUrl(url)) {                                                  await launchUrl(url);                                                } else {                                                  throw 'Could not launch $url';                                                }                                              },                                              child: Container(                                                  padding: EdgeInsets.symmetric(                                                      vertical: 10),                                                  color: Color(0xff38853B),                                                  child: Row(                                                    // mainAxisAlignment: MainAxisAlignment.spaceBetween,                                                    mainAxisAlignment:                                                        MainAxisAlignment                                                            .center,                                                    crossAxisAlignment:                                                        CrossAxisAlignment                                                            .center,                                                    children: const [                                                      Icon(                                                        Icons.remove_red_eye,                                                        size: 20,                                                        color: white,                                                      ),                                                      SizedBox(                                                        width: 5,                                                      ),                                                      Text('View',                                                          style: TextStyle(                                                              color: white)),                                                    ],                                                  )),                                            )),                                            Expanded(                                                child: InkWell(                                              onTap: () async {                                                await Share.share(                                                    "https://schoolworkspro.com/certificate/${value2.id}");                                              },                                              child: Container(                                                  color: Color(0xff195DE6),                                                  padding: EdgeInsets.symmetric(                                                      vertical: 10),                                                  child: Row(                                                    // mainAxisAlignment: MainAxisAlignment.spaceBetween,                                                    mainAxisAlignment:                                                        MainAxisAlignment                                                            .center,                                                    crossAxisAlignment:                                                        CrossAxisAlignment                                                            .center,                                                    children: const [                                                      Icon(Icons.share,                                                          size: 20,                                                          color: white),                                                      SizedBox(                                                        width: 5,                                                      ),                                                      Text(                                                        'Share',                                                        style: TextStyle(                                                            color: white),                                                      ),                                                    ],                                                  )),                                            )),                                          ],                                        ),                                      ],                                    ),                                  );                                })),                      ],                    );          // ListView.builder(          //             itemCount:          //                 snapShot.myAchievement.achievements!.length,          //             itemBuilder: (context, index) {          //               var value2 = snapShot          //                   .myAchievement.achievements![index];          //               return Padding(          //                 padding: const EdgeInsets.symmetric(          //                     horizontal: 15, vertical: 20),          //                 child: Card(          //                     child: Container(          //                   padding:          //                       const EdgeInsets.only(bottom: 15),          //                   child: Column(          //                     crossAxisAlignment:          //                         CrossAxisAlignment.start,          //                     children: [          //                       Center(          //                           child: CachedNetworkImage(          //                         fit: BoxFit.fill,          //                         imageUrl:          //                             '$api_url2/uploads/modules/${value2.moduleId!.imageUrl}',          //                         placeholder: (context, url) =>          //                             const Center(          //                                 child:          //                                     CupertinoActivityIndicator()),          //                         errorWidget:          //                             (context, url, error) =>          //                                 const Icon(Icons.error),          //                       )),          //                       const SizedBox(          //                         height: 10,          //                       ),          //                       Padding(          //                         padding: const EdgeInsets.symmetric(          //                             horizontal: 10),          //                         child: Column(          //                           crossAxisAlignment:          //                               CrossAxisAlignment.start,          //                           children: [          //                             Text(          //                               "Achieved at: ${DateFormat('MMM dd, yyyy').format(value2.achievedAt!)}",          //                               style: const TextStyle(          //                                   fontSize: 12,          //                                   color: Colors.grey),          //                             ),          //                             Row(          //                               children: [          //                                 Expanded(          //                                     child: Text(          //                                   value2          //                                       .moduleId!.moduleTitle          //                                       .toString(),          //                                   style: TextStyle(          //                                       fontSize: 17),          //                                 )),          //                                 const Icon(          //                                   Icons.military_tech,          //                                   color: Colors.green,          //                                   size: 28,          //                                 ),          //                               ],          //                             ),          //                             const SizedBox(          //                               height: 10,          //                             ),          //                             Row(          //                               mainAxisAlignment:          //                                   MainAxisAlignment.start,          //                               children: [          //                                 ElevatedButton(          //                                     onPressed: () async {          //                                       String url1 =          //                                           "https://schoolworkspro.com/certificate/${value2.id}";          //                                       // Navigator.push(context, MaterialPageRoute(builder: (context)=>ViewReportWebView(url: url1)));          //          //                                       var url =          //                                           Uri.parse(url1);          //                                       if (await canLaunchUrl(          //                                           url)) {          //                                         await launchUrl(          //                                             url);          //                                       } else {          //                                         throw 'Could not launch $url';          //                                       }          //                                     },          //                                     style: ElevatedButton          //                                         .styleFrom(          //                                       primary: Colors.red,          //                                     ),          //                                     child: Row(          //                                       children: const [          //                                         Icon(          //                                             Icons          //                                                 .remove_red_eye,          //                                             size: 20),          //                                         SizedBox(          //                                           width: 3,          //                                         ),          //                                         Text('View'),          //                                       ],          //                                     )),          //                                 const SizedBox(          //                                   width: 10,          //                                 ),          //                                 ElevatedButton(          //                                     onPressed: () async {          //                                       await Share.share(          //                                           "https://schoolworkspro.com/certificate/${value2.id}");          //                                     },          //                                     child: Row(          //                                       // mainAxisAlignment: MainAxisAlignment.spaceBetween,          //                                       children: const [          //                                         Icon(          //                                           Icons.share,          //                                           size: 20,          //                                         ),          //                                         SizedBox(          //                                           width: 5,          //                                         ),          //                                         Text('Share'),          //                                       ],          //                                     )),          //                               ],          //                             )          //                           ],          //                         ),          //                       )          //                     ],          //                   ),          //                 )),          //               );          //             },          //           );        },      ),    );  }}