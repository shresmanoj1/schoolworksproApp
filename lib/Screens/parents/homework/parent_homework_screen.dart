import 'package:flutter/material.dart';import 'package:provider/provider.dart';import 'package:schoolworkspro_app/Screens/parents/homework/parent_homework_view_model.dart';import 'package:schoolworkspro_app/components/shimmer.dart';import '../../../config/api_response_config.dart';import '../../../constants/colors.dart';class ParentHomeworkScreen extends StatefulWidget {  final institution;  final username;  ParentHomeworkScreen(      {Key? key, required this.institution, required this.username})      : super(key: key);  @override  State<ParentHomeworkScreen> createState() =>      _ParentHomeworkScreenState();}class _ParentHomeworkScreenState extends State<ParentHomeworkScreen> {  late ParentHomeworkViewModel parentHomeworkViewModel;  String? selected_module;  String? feedback;  String? homeworkStatus;  @override  void initState() {    WidgetsBinding.instance.addPostFrameCallback((timeStamp) {      parentHomeworkViewModel = Provider.of<ParentHomeworkViewModel>(          context,          listen: false);      parentHomeworkViewModel.fetchModule(        widget.institution,        widget.username,      );    });    super.initState();  }  @override  Widget build(BuildContext context) {    return Consumer<ParentHomeworkViewModel>(        builder: (context, modules, child) {      return Scaffold(          appBar: AppBar(            title: const Text(              "Digital Diary",              style: TextStyle(color: white),            ),            elevation: 0,            // backgroundColor: Colors.white,            // elevation: 0.0,            // iconTheme: const IconThemeData(color: Colors.black),          ),          body: isLoading(modules.getChildrenModuleResponse)              ? const VerticalLoader()              : ListView(                  shrinkWrap: true,                  physics: const ScrollPhysics(),                  padding: const EdgeInsets.symmetric(horizontal: 10),                  children: [                    DropdownButtonFormField(                      isExpanded: true,                      decoration: const InputDecoration(                        border: InputBorder.none,                        filled: true,                        hintText: 'Select module/Subject',                      ),                      icon:                          const Icon(Icons.arrow_drop_down_outlined),                      items: modules.module.allModules?.map((pt) {                        return DropdownMenuItem(                          value: pt.moduleSlug.toString(),                          child: Text(                            pt.moduleTitle.toString(),                            overflow: TextOverflow.ellipsis,                          ),                        );                      }).toList(),                      onChanged: (newVal) {                        setState(() {                          selected_module = newVal as String;                          parentHomeworkViewModel.fetchOfflineTask(                            widget.institution,                            selected_module,                            widget.username,                          );                        });                      },                      value: selected_module,                    ),                    const SizedBox(                      height: 10,                    ),                    selected_module == null                        ? Container(                            width: double.infinity,                            color: Colors.orange.shade200,                            child: const Padding(                              padding: EdgeInsets.all(8.0),                              child: Text(                                  "Select batch to view Digital Diary"),                            ))                        : isLoading(                        modules.getOfflineTaskResponse)                        ? const VerticalLoader()                        :                    modules.offlineTask == null ||                                modules.offlineTask!.isEmpty                            ? Image.asset(                                'assets/images/no_content.PNG')                            : ListView.builder(                                    shrinkWrap: true,                                    physics: const ScrollPhysics(),                                    itemCount:                                        modules.offlineTask!.length,                                    itemBuilder: (context, index) {                                      final offlineHomework =                                          modules.offlineTask![index];                                      return modules                                              .offlineTask!.isNotEmpty                                          ? Card(                                        margin: const EdgeInsets.symmetric(vertical: 10),                                              child: Padding(                                                padding: const EdgeInsets                                                    .symmetric(                                                        horizontal:                                                            5),                                                child: Column(                                                  children: [                                                    Builder(builder:                                                        (context) {                                                      return ExpansionTile(                                                        title: Text(                                                          offlineHomework.taskname.toString(),                                                          maxLines:                                                              10,                                                          overflow:                                                              TextOverflow                                                                  .ellipsis,                                                          style: const TextStyle(                                                              fontSize:                                                                  16, color: Colors.black),                                                        ),                                                        trailing:                                                            const Icon(                                                                Icons                                                                    .add),                                                        children: [                                                          offlineHomework.students != null &&  offlineHomework.students!.isNotEmpty                                                              ? ListView.builder(                                                                  shrinkWrap: true,                                                                  physics: const ScrollPhysics(),                                                                  padding: const EdgeInsets.symmetric(horizontal: 10),                                                                  itemCount: offlineHomework.students!.length,                                                                  itemBuilder: (context, studentIndex) {                                                                    return Column(                                                                      crossAxisAlignment: CrossAxisAlignment.start,                                                                      children: [                                                                        const SizedBox(                                                                          height: 20,                                                                        ),                                                                        Row(                                                                          mainAxisAlignment: MainAxisAlignment.spaceBetween,                                                                          children: [                                                                            Container(                                                                              decoration: BoxDecoration(                                                                                color: Colors.green,                                                                                borderRadius: BorderRadius.circular(5),                                                                              ),                                                                              child: const Padding(                                                                                padding: EdgeInsets.all(7),                                                                                child: Text(                                                                                  'Submitted',                                                                                  style: TextStyle(color: Colors.white, fontWeight: FontWeight.w900, fontSize: 10),                                                                                ),                                                                              ),                                                                            ),                                                                            Container(                                                                              decoration: BoxDecoration(                                                                                color: Colors.red,                                                                                borderRadius: BorderRadius.circular(5),                                                                              ),                                                                              child: Padding(                                                                                padding: const EdgeInsets.all(7),                                                                                child: Text(                                                                                  "Due on: ${offlineHomework.dueDate?.day}/${offlineHomework.dueDate?.month}/${offlineHomework.dueDate?.year}",                                                                                  style: const TextStyle(color: Colors.white, fontWeight: FontWeight.w900, fontSize: 10),                                                                                ),                                                                              ),                                                                            ),                                                                          ],                                                                        ),                                                                        // SizedBox(height: 10,),                                                                        Padding(                                                                          padding: const EdgeInsets.symmetric(vertical: 10),                                                                          child: Container(                                                                            width: MediaQuery.of(context).size.width,                                                                            decoration: BoxDecoration(                                                                              borderRadius: BorderRadius.circular(3),                                                                              color: Colors.lightGreen,                                                                            ),                                                                            child: Padding(                                                                              padding: const EdgeInsets.all(7),                                                                              child: Row(                                                                                children: [                                                                                  Text(                                                                                    'Feedback : ',                                                                                    style: TextStyle(color: Colors.white, fontWeight: FontWeight.bold, fontSize: 13),                                                                                  ),                                                                                  Flexible(                                                                                      child: Text(                                                                                        offlineHomework.students![studentIndex].feedback == null ? "Feedback has not been provided" : offlineHomework.students![studentIndex].feedback.toString(),                                                                                    textAlign: TextAlign.justify,                                                                                    style: TextStyle(color: Colors.white, fontWeight: FontWeight.bold, fontSize: 13),                                                                                  )),                                                                                ],                                                                              ),                                                                            ),                                                                          ),                                                                        ),                                                                      ],                                                                    );                                                                  })                                                              : Padding(                                                                  padding:                                                                      const EdgeInsets.symmetric(vertical: 10, horizontal: 10),                                                                  child:                                                                      Row(                                                                    mainAxisAlignment: MainAxisAlignment.spaceBetween,                                                                    children: [                                                                      Align(                                                                          alignment: Alignment.topLeft,                                                                          child: Container(                                                                            decoration: BoxDecoration(                                                                              color: Colors.pinkAccent,                                                                              borderRadius: BorderRadius.circular(5),                                                                            ),                                                                            child: const Padding(                                                                              padding: EdgeInsets.all(7),                                                                              child: Text(                                                                                'Not submitted',                                                                                style: TextStyle(color: Colors.white, fontWeight: FontWeight.w900, fontSize: 10),                                                                              ),                                                                            ),                                                                          )),                                                                      Container(                                                                        decoration: BoxDecoration(                                                                          color: Colors.red,                                                                          borderRadius: BorderRadius.circular(5),                                                                        ),                                                                        child: Padding(                                                                          padding: const EdgeInsets.all(7),                                                                          child: Text(                                                                            "Due on: ${offlineHomework.dueDate!.day}/${offlineHomework.dueDate!.month}/${offlineHomework.dueDate!.year}",                                                                            style: const TextStyle(color: Colors.white, fontWeight: FontWeight.w900, fontSize: 10),                                                                          ),                                                                        ),                                                                      ),                                                                    ],                                                                  ),                                                                ),                                                        ],                                                      );                                                    }),                                                  ],                                                ),                                              ),                                            )                                          : Image.asset(                                              "assets/images/no_content.PNG");                                    }),                  ],                ));    });  }}